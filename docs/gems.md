# Gems / Гемы

## Где лежит конфиг магазина
- Пакеты гемов и выбор провайдера находятся в `config/gemsShop.js`.
- Поле `provider` переключает реализацию покупки в одну строку:
  - `"mock"` — рабочая заглушка покупки.
  - `"yandex"` — `YandexPurchaseProvider` (пока `NOT_IMPLEMENTED`).

## Что внедрено
- Единая точка работы с валютой: `GemsService` в `main.js`.
- Баланс гемов хранится в `player.gems`, сохраняется в `localStorage` и восстанавливается при загрузке.
- Если в старом сейве `gems` отсутствует/битый — используется `0`.
- HUD-блок гемов (`#btnGemsHud`, `#gems`) открывает модалку магазина.
- Магазин (`#gemsShopOverlay`) рендерит список паков только из `config/gemsShop.js`.
- Покупка идет только через `PurchaseProvider` интерфейс (`MockPurchaseProvider` / `YandexPurchaseProvider`).

## События и логирование
- `GEMS_CHANGED` — реактивное обновление HUD.
- `SHOP_OPEN`, `SHOP_PURCHASE_CLICK`, `CURRENCY_ADD`.
- Аналитика/лог: `logEvent(name, payload)` (сейчас через `console.log`).

## Dev-инструменты
Доступны только при `?dev`:
- Кнопки панели:
  - `DEV +100 [gem]`
  - `DEV set 0 [gem]`
- Горячие клавиши:
  - `G` → `+100 [gem]`
  - `0` → `set 0 [gem]`

## Как тестировать вручную
1. Запустить игру и открыть HUD.
2. Нажать на блок [gem] в верхней панели — откроется «Магазин гемов».
3. Купить любой пак — появится тост `Покупка успешна: +N [gem]`, баланс обновится сразу.
4. Перезагрузить страницу — баланс гемов сохранится.
5. Для dev-тестов открыть с `?dev`, проверить кнопки/горячие клавиши.
