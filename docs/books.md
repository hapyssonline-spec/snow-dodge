# Книги рыболовства

## Цены
- **COMMON SENSE** — 6000 [coin]
- **RARE SENSE** — 30000 [coin] или 199 [gem]
- **EPIC SENSE** — 90000 [coin] или 399 [gem]

## Прогрессия и разблокировка
- Покупки одноразовые и перманентные.
- Строгая цепочка:
  1. COMMON SENSE
  2. RARE SENSE (после COMMON)
  3. EPIC SENSE (после RARE)
- В UI заблокированные книги приглушены, отмечены замком, при клике показывают подсказку с требуемой предыдущей книгой.

## Где в коде триггеры туториала
- После покупки первой книги (COMMON) показывается окно **«Новое чутьё»**: `showBooksIntroModal` в `main.js`.
- Во время реальной рыбалки:
  - Подсказка для веса срабатывает в момент первого появления строки веса в `setHintTexts` → `maybeRunBooksFightTutorial`.
  - Подсказка для вида срабатывает в момент первого появления строки вида в `setHintTexts` → `maybeRunBooksFightTutorial`.
  - Если вид отображается как `??????`, в этой же подсказке добавляется пояснение про неизвестный вид.

## Как тестировать
1. Открыть город → **Снасти** → вкладка **Книги**.
2. Проверить блокировки: RARE/EPIC закрыты до покупки предыдущих.
3. Купить COMMON за монеты, убедиться что:
   - карточка стала «Куплена»;
   - показалось окно «Новое чутьё»;
   - RARE разблокировалась.
4. Купить RARE/EPIC за монеты и гемы.
5. При нехватке гемов проверить сообщение и автопереход в магазин гемов.
6. Начать вываживание после покупки COMMON:
   - при первом появлении веса — одноразовая подсказка;
   - при первом появлении вида — одноразовая подсказка;
   - для непойманных/легендарных видов отображается `??????`.

## Анти-утечки в подсказках вываживания
- Центральная маска названий видов: `RevealSystem.maskSpeciesName(speciesId)` в `main.js`.
  - Порядок проверок фиксирован: легендарная рыба → `??????`, непойманный вид → `??????`, и только затем локализованное имя.
- Строгий гейт по прогрессу: `revealWeightStage` и `revealSpeciesStage` (оба `0..N`) внутри `RevealSystem`.
  - На `stage=0` строки `Вес`/`Вид` не показываются.
  - Обновление UI выполняется только при изменении стадии (`revealSystem.hasHintChanges()`).
