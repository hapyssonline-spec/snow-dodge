# Аудит репозитория snow-dodge (срез на 2026-02-17)

## 1) Что это за проект сейчас

Проект уже не «голый прототип», а рабочая **веб-игра про зимнюю рыбалку** с:
- геймплейным циклом «заброс → поклёвка → мини-дуэль (натяжение/выматывание) → улов/срыв»;
- городской сценой с интерактивными точками (магазины/трофейная);
- прогрессией игрока (уровень/XP);
- экономикой (монеты, продажа рыбы, апгрейды снастей и приманок);
- квестами;
- локальными лидербордами;
- PWA-обвязкой (manifest + service worker).

По структуре это **vanilla JS single-page игра** без внешнего фреймворка и без сборки: `index.html` + `style.css` + большой `main.js` + `audio/AudioManager.js`.

## 2) Что проверено в рамках аудита

Проверены все текстовые исходники проекта:
- `index.html` (569 строк)
- `style.css` (3300 строк)
- `main.js` (6574 строки)
- `audio/AudioManager.js` (427 строк)
- `sw.js` (91 строка)
- `manifest.json` (20 строк)
- `README.txt` (18 строк)
- `GAME_SIZE.md` (1 строка)

Суммарно просмотрено: **11 000 строк текстового кода/конфига**.

Дополнительно прогнаны проверки:
- синтаксис JS (`node --check`) для `main.js` и `audio/AudioManager.js`;
- валидность JSON (`python -m json.tool`) для `manifest.json`;
- сверка ссылок на ассеты из кода с реальными файлами в репозитории.

## 3) Стадия проекта (по этапам)

### Этап A — Базовый каркас игры: ✅ пройден
Есть полная сцена, канвас, HUD, адаптация под мобильный/десктопный фон, слоистая композиция героя/удочки/поплавка.

### Этап B — Основная механика рыбалки: ✅ пройден
Реализована core-механика ловли с состояниями и UI дуэли (натяжение лески, шкала выматывания, риск срыва, подсказки).

### Этап C — Контент и редкости: ✅ пройден
Есть таблица видов рыбы, редкости, иконки, веса, шансы, ограничения по уровню снастей.

### Этап D — Метапрогрессия: ✅ пройден
Есть монеты, XP/уровни, инвентарь, сохранение, улучшения удочек/лески, расходники/приманки.

### Этап E — Надстройки live-loop: ✅ пройден
Есть квесты разной сложности, награды, подсказки/напоминания, перегенерация и таймеры доступности.

### Этап F — Социальный/соревновательный контур: ✅ базово пройден
Добавлены локальные лидерборды по нескольким метрикам, профиль и статистика рекордов.

### Этап G — Платформенная упаковка (PWA): ✅ базово пройден
Есть `manifest.json`, `sw.js`, кэширование для офлайна, iOS web-app meta-теги.

### Этап H — Подготовка к Яндекс.Играм и монетизации: ⚠️ частично
Сильная игровая база уже есть, но до «боевой публикации/монетизации» не хватает интеграционного слоя платформы и операционных вещей (SDK, реклама, облачные лидерборды/сейвы, аналитика, анти-чит, балансные проходы, QA на устройствах).

## 4) Технический разбор текущего состояния

### 4.1 Архитектурно
- Проект монолитный: почти вся логика сосредоточена в `main.js`.
- Подход рабочий для быстрого развития, но цена — сложность поддержки (регрессии и высокая связность).
- Сильная сторона: много защитной логики UI-событий, модалок, слоёв и тач-взаимодействий.

### 4.2 Геймдизайн/системы
- Есть хороший фундамент retention-loop: ловля + прокачка + квесты + коллекция + редкости.
- Есть зачатки долгосрочной мотивации (трофеи/редкие виды/статистика/уровни).
- Городская сцена уже задаёт направление для будущих мета-систем.

### 4.3 Данные/персистентность
- Локальное хранение реализовано через `localStorage`.
- Есть версионность данных и нормализация части сущностей при загрузке.
- Для платформенной публикации потребуется серверный/платформенный контур для устойчивости прогресса.

### 4.4 UI/UX
- Интерфейс насыщенный: топбар, боттомбар, сцены, оверлеи, профиль, шоп, лидерборды, подсказки.
- Много адаптивной логики (safe-area/viewport/ориентация), что критично для мобильного трафика.
- Это уже «игра с оболочкой», а не технодемо.

### 4.5 Аудио
- Есть отдельный аудио-менеджер с синтезом/лупами/фейдами и управлением контекстом.
- Для web-игры это хороший уровень контроля и задел на event-based звуковую драматургию.

## 5) Найденные риски и дефекты (важно исправить)

1. **Несовпадение ассета в сервис-воркере**:
   - в `sw.js` кэшируется `./assets/fish/karas_serebryanyy.png`,
   - фактически в репозитории лежит `assets/fish/karas.png`.
   Это потенциально ломает precache/install на части браузеров/сценариев.

2. **Упоминание `hole.png` в документации, но файла нет в корне**:
   - в `README.txt` фигурирует `hole.png`,
   - файла в репозитории не найдено.
   Возможно артефакт старой версии.

3. **Упоминание `prev.html` в текстах/поисковых срабатываниях при анализе ссылок**:
   - файла нет в репозитории.
   Стоит зачистить устаревшие упоминания, чтобы не путать при дальнейшем рефакторинге.

## 6) На каком вы сейчас этапе разработки (кратко для переноса в новый чат)

Сейчас проект на стадии:

1. **Vertical Slice+** (игра полноценно играется, есть законченный базовый цикл).
2. **Content/Meta Systems в активной фазе** (квесты, прогрессия, магазин, лидерборды уже в работе).
3. **Pre-Production портирования в Яндекс.Игры** (архитектурно и по UX база готова, но SDK/монетизация/платформенные сервисы пока не закрыты).

Если формально: это **поздний MVP / ранний production-hardening**.

## 7) Что делать дальше (приоритетный бэклог)

### Критично перед платформенной интеграцией
1. Исправить ассет-расхождения (`sw.js`, документация, мёртвые ссылки).
2. Разделить `main.js` на модули (state, fishing loop, ui, economy, quests, persistence).
3. Ввести базовые smoke/regression проверки (хотя бы сценарные).

### Для Яндекс.Игр
4. Подключить SDK Яндекс.Игр (инициализация, ready, lifecycle).
5. Добавить монетизацию (rewarded/interstitial) в безопасные UX-точки.
6. Перевести лидерборды/часть прогресса на платформенные сервисы или свой backend.
7. Добавить аналитику событий (воронка: сессия → бой → улов → продажа → апгрейд).

### Для роста удержания и ARPDAU
8. Ежедневные/недельные активности, streaks, time-limited задания.
9. Ивентовые рыбы/сезонные бусты.
10. Балансный проход экономики и кривой XP по данным аналитики.

## 8) Вывод

Текущая версия — это уже **содержательная игровая база**, а не прототип «на один экран». До монетизации в Яндекс.Играх осталось не «написать игру», а **доделать платформенный и операционный слой** плюс немного техдолга по структуре/проверкам.
